version: '3.7'
volumes:
  clubhouse-mysql-data:
services:
  mysql:
    image: mysql:5.6
    environment:
      MYSQL_ROOT_PASSWORD: my-secret-pw
      MYSQL_DATABASE: clubhouse_dev
    volumes:
      - clubhouse-mysql-data:/var/lib/mysql
  clubhouse:
    build:
      context: .
      shm_size: 1G
    ports:
      - "8080:8080"
    depends_on:
      - mysql
    volumes:
      - ./src:/backend/src
      - ./test:/backend/test
      - ./seeds:/backend/seeds
      - ./migrations:/backend/migrations
      - ./knexfile.ts:/backend/knexfile.ts
    environment:
      NODE_ENV: development
      # Back-end port
      PORT: 8080
      # JWT
      JWT_SECRET: abcd1234
      JWT_EXPIRE: 86400
      # Calendar
      CAL_DOMAIN: clubhouse.com
      CAL_LOCATION: Club house
      # Knex debug
      # DEBUG=knex:query
      # MySQL
      MYSQL_HOST: mysql
      MYSQL_PORT: 3306
      MYSQL_USER: root
      MYSQL_PASSWORD: my-secret-pw
      MYSQL_DB_NAME: clubhouse
      # Email
      ENABLE_EMAIL_SENDING: "yes"
      MAIL_PREFIX: Clubhouse
      MAIL_FROM_ADDRESS: clubhouse@example.com
      MAIL_FROM_NAME: Clubhouse
      SMTP_SERVER: smtp.ethereal.email
      SMTP_USERNAME: qd3m27cu6ds4u4dd@ethereal.email
      SMTP_PASSWORD: 3YaRwf2q5hMdkQ6yFM
      SMTP_PORT: 587
      SMTP_SECURE: "true"